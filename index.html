<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>LacMapper‚Ñ¢ - Portal de Mapas e Scripts</title>
    <meta name="description" content="A maior comunidade de compartilhamento de mapas e scripts para jogos. Baixe, vote e publique seus mapas no LacMapper‚Ñ¢ de gra√ßa.">
    <meta name="keywords" content="mapas, scripts, lacmapper, download mapas, portal de mapas, games, editor de mapas">
    <meta name="author" content="LacMapper Team">
    
    <meta property="og:title" content="LacMapper‚Ñ¢ - Portal de Mapas">
    <meta property="og:description" content="Os melhores mapas da comunidade est√£o aqui. Publique o seu tamb√©m!">
    <meta property="og:image" content="1000132243.png">
    <meta property="og:type" content="website">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020617; color: #f1f5f9; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        .glass { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .active-tab { color: #3b82f6; border-bottom: 3px solid #3b82f6; }
        #crop-container { aspect-ratio: 16/9; overflow: hidden; position: relative; background: #000; border-radius: 16px; touch-action: none; border: 2px solid rgba(59, 130, 246, 0.3); }
        #crop-image { position: absolute; cursor: move; touch-action: none; user-select: none; max-width: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        button { cursor: pointer; transition: transform 0.1s; }
        button:active { transform: scale(0.95); }
        .card-anim { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none !important; pointer-events: none !important; }

        .ad-slot-main { width: 100%; display: flex; justify-content: center; align-items: flex-start; overflow: hidden; margin: 15px auto; min-height: 50px; transition: height 0.3s ease; }
        .ad-scaler-el { transform-origin: top center; display: inline-block; flex-shrink: 0; }

        #ad-interstitial { position: fixed; inset: 0; z-index: 200; background: #020617; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        #close-ad-timer { position: absolute; top: 20px; right: 20px; width: 45px; height: 45px; background: #fff; color: #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; box-shadow: 0 0 20px rgba(255,255,255,0.2); pointer-events: none; opacity: 0.5; }
        #close-ad-timer.ready { pointer-events: auto; opacity: 1; cursor: pointer; }

        .verified-border { border: 2px solid #3b82f6; box-shadow: 0 0 15px rgba(59, 130, 246, 0.5); }
        .verified-badge { background: linear-gradient(45deg, #3b82f6, #60a5fa); }
        .avatar-frame { position: relative; }
        .avatar-frame.verified::after { content: ''; position: absolute; inset: -3px; border: 2px solid #3b82f6; border-radius: 50%; animation: pulse-border 2s infinite; }
        @keyframes pulse-border { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.05); } 100% { opacity: 1; transform: scale(1); } }
        .profile-banner { aspect-ratio: 16/9; width: 100%; object-fit: cover; background: #1e293b; }
        
        /* Ranking Styles */
        .rank-card { background: linear-gradient(to right, rgba(59, 130, 246, 0.1), transparent); border-left: 4px solid #3b82f6; }
        .rank-1 { background: linear-gradient(to right, rgba(234, 179, 8, 0.2), transparent); border-left: 4px solid #eab308; }
        .rank-2 { background: linear-gradient(to right, rgba(148, 163, 184, 0.2), transparent); border-left: 4px solid #94a3b8; }
        .rank-3 { background: linear-gradient(to right, rgba(180, 83, 9, 0.2), transparent); border-left: 4px solid #b45309; }
    </style>
</head>
<body class="pb-24 min-h-screen flex flex-col">

    <div id="ad-interstitial">
        <div id="close-ad-timer">5</div>
        <div class="w-full max-w-md mb-8">
            <p class="text-[10px] font-black uppercase tracking-widest text-slate-500 mb-4">Recomendado</p>
            <div id="container-1f32791f740b14e44a8b9a32b19185f7"></div>
            
        </div>
        <div class="glass p-4 rounded-3xl border border-blue-500/20">
            <script type="text/javascript">
                atOptions = { 'key' : '745cf56074e768501f24905439e2eb11', 'format' : 'iframe', 'height' : 250, 'width' : 300, 'params' : {} };
            </script>
            
        </div>
        <p class="mt-8 text-[11px] font-black uppercase text-blue-500 animate-pulse">Publica√ß√£o em andamento...</p>
        <div id="popunder-trigger-area"></div>
    </div>

    <div id="toast" class="fixed top-20 left-1/2 -translate-x-1/2 z-[110] hidden pointer-events-none transition-all duration-300">
        <div class="bg-blue-600 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 border border-white/20">
            <span id="toast-text" class="text-[10px] font-black uppercase tracking-wider"></span>
        </div>
    </div>

    <nav class="fixed top-0 w-full z-50 glass border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3" onclick="location.reload()">
                <div class="w-10 h-10 bg-slate-900 rounded-xl flex items-center justify-center overflow-hidden border border-white/10 shadow-lg">
                    <img src="1000132243.png" alt="LacMapper Logo" class="w-full h-full object-contain p-1">
                </div>
                <span class="text-xl font-black italic tracking-tighter uppercase hidden xs:block">LacMapper‚Ñ¢</span>
            </div>
            <div class="flex items-center gap-3">
                <button id="btn-trigger-ranking" class="p-2.5 text-yellow-500 hover:bg-white/5 rounded-xl transition-colors">
                    <i data-lucide="trophy" class="w-6 h-6"></i>
                </button>
                <div id="nav-unlogged">
                    <button id="btn-trigger-login" class="bg-white text-black text-[10px] font-black uppercase px-6 py-2.5 rounded-full shadow-lg">Entrar</button>
                </div>
                <div id="nav-logged" class="hidden flex items-center gap-3">
                    <div class="avatar-frame" id="nav-avatar-frame">
                        <img id="nav-avatar" class="w-9 h-9 rounded-full border-2 border-blue-500/50 object-cover shadow-lg cursor-pointer" src="">
                    </div>
                    <button id="btn-trigger-post" class="bg-blue-600 text-white p-2.5 rounded-xl shadow-lg">
                        <i data-lucide="plus" class="w-6 h-6"></i>
                    </button>
                    <button id="btn-trigger-logout" class="p-2 text-slate-500 hover:text-rose-500 transition-colors">
                        <i data-lucide="log-out" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <header class="pt-24 px-4 max-w-7xl mx-auto w-full">
        <div class="flex items-center gap-4 border-b border-white/5 mb-8 overflow-x-auto no-scrollbar">
            <button id="tab-recent" class="px-5 py-4 text-[10px] font-black uppercase tracking-[0.25em] active-tab transition-all whitespace-nowrap">Recentes</button>
            <button id="tab-popular" class="px-5 py-4 text-[10px] font-black uppercase tracking-[0.25em] text-slate-500 transition-all whitespace-nowrap">Populares</button>
        </div>
        <div class="relative max-w-lg mb-6 mx-auto">
            <i data-lucide="search" class="absolute left-5 top-1/2 -translate-y-1/2 text-slate-500 w-5 h-5"></i>
            <input type="text" id="input-search" placeholder="Pesquisar mapas ou autores..." class="w-full bg-white/5 border border-white/10 rounded-2xl py-4.5 pl-14 pr-6 outline-none focus:ring-2 focus:ring-blue-500/50 transition-all text-sm font-bold">
        </div>
        <div class="mb-8 max-w-lg mx-auto">
            <a href="https://www.effectivegatecpm.com/azth964d2r?key=9423dc279cee8c1a20effe84e3b81719" target="_blank" class="flex items-center justify-between bg-gradient-to-r from-blue-600 to-indigo-700 p-4 rounded-2xl shadow-xl hover:scale-[1.02] transition-transform">
                <div class="flex items-center gap-3">
                    <div class="bg-white/20 p-2 rounded-lg"><i data-lucide="zap" class="w-5 h-5 text-yellow-300 fill-yellow-300"></i></div>
                    <div>
                        <h4 class="text-[10px] font-black uppercase leading-tight italic">Scripts Premium</h4>
                        <p class="text-[9px] font-bold text-white/70">Acesse agora conte√∫do exclusivo</p>
                    </div>
                </div>
                <i data-lucide="chevron-right" class="w-5 h-5 text-white/50"></i>
            </a>
        </div>
        <div class="ad-slot-main">
            <div id="ad-scaler-1" class="ad-scaler-el">
                <script type="text/javascript">
                  atOptions = { 'key' : 'f2fc11825c77506816279c5b1393084e', 'format' : 'iframe', 'height' : 90, 'width' : 728, 'params' : {} };
                </script>
                
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 flex-grow w-full">
        <div id="loading" class="py-24 text-center">
            <div class="inline-block w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p class="font-black uppercase text-slate-600 tracking-widest text-[10px]">Sincronizando Banco de Dados‚Ñ¢...</p>
        </div>
        <div id="map-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
    </main>

    <div class="ad-slot-main mt-12">
        <div id="ad-scaler-2" class="ad-scaler-el">
            <div id="container-c032003c376ec812a388135541d20cf3"></div>
        </div>
    </div>

    <div id="modal-ranking" class="fixed inset-0 z-[130] glass flex items-center justify-center p-4 hidden">
        <div class="bg-[#0f172a] w-full max-w-xl rounded-[2.5rem] border border-white/10 shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="p-6 border-b border-white/5 flex justify-between items-center bg-white/5">
                <div class="flex items-center gap-3">
                    <i data-lucide="trophy" class="text-yellow-500"></i>
                    <h3 class="font-black uppercase tracking-tighter italic text-xl">Hall da Fama</h3>
                </div>
                <button onclick="document.getElementById('modal-ranking').classList.add('hidden')" class="text-slate-400 p-2"><i data-lucide="x"></i></button>
            </div>
            <div class="flex border-b border-white/5 bg-white/5">
                <button id="rank-tab-global" class="flex-1 py-4 text-[10px] font-black uppercase tracking-widest active-tab">Global</button>
                <button id="rank-tab-country" class="flex-1 py-4 text-[10px] font-black uppercase tracking-widest text-slate-500">Meu Pa√≠s</button>
            </div>
            <div id="ranking-list" class="p-4 space-y-3 overflow-y-auto no-scrollbar flex-grow">
                </div>
        </div>
    </div>

    <div id="modal-auth" class="fixed inset-0 z-[100] glass flex items-center justify-center p-4 hidden">
        <div class="bg-[#0f172a] w-full max-w-md rounded-[2.5rem] border border-white/10 shadow-2xl overflow-hidden flex flex-col">
            <div class="p-6 border-b border-white/5 flex justify-between items-center bg-white/5">
                <h3 id="auth-header-title" class="font-black uppercase tracking-tighter italic text-xl">Fazer Login</h3>
                <button id="btn-close-auth" class="text-slate-400 p-2"><i data-lucide="x"></i></button>
            </div>
            <div class="p-8 space-y-5 overflow-y-auto no-scrollbar max-h-[80vh]">
                <div id="auth-register-only" class="hidden space-y-5">
                    <div class="flex flex-col items-center gap-3">
                        <label class="relative cursor-pointer">
                            <div class="w-20 h-20 rounded-full bg-slate-800 border-2 border-dashed border-white/20 flex items-center justify-center overflow-hidden">
                                <img id="auth-avatar-preview" class="w-full h-full object-cover hidden" src="">
                                <i id="auth-avatar-icon" data-lucide="camera" class="text-slate-500"></i>
                            </div>
                            <input id="auth-avatar-input" type="file" accept="image/*" class="hidden">
                        </label>
                        <span class="text-[9px] font-black uppercase text-slate-500 tracking-widest">Foto de Perfil</span>
                    </div>
                    <div>
                        <label class="text-[10px] font-black uppercase text-slate-500 mb-2 block">Nome Completo</label>
                        <input id="auth-name" type="text" placeholder="M√≠nimo 4 letras" class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 outline-none focus:border-blue-500 transition-all font-bold">
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 mb-2 block tracking-widest">Identificador</label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 font-black text-blue-500 italic">@</span>
                        <input id="auth-handle" type="text" placeholder="teunome" class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 pl-9 outline-none focus:border-blue-500 transition-all font-bold lowercase">
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 mb-2 block tracking-widest">Senha</label>
                    <input id="auth-pass" type="password" placeholder="M√≠nimo 8 d√≠gitos" class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 outline-none focus:border-blue-500 transition-all font-bold">
                </div>
                <div id="auth-register-pass-confirm" class="hidden">
                    <label class="text-[10px] font-black uppercase text-slate-500 mb-2 block tracking-widest">Confirmar Senha</label>
                    <input id="auth-pass-confirm" type="password" placeholder="Repete a senha" class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 outline-none focus:border-blue-500 transition-all font-bold">
                </div>
                <div id="auth-error-msg" class="text-rose-500 text-[10px] font-black uppercase text-center hidden">Informa√ß√µes Inv√°lidas</div>
                <button id="btn-auth-confirm" class="w-full bg-blue-600 py-5 rounded-[1.5rem] text-sm font-black uppercase shadow-xl active:scale-95 transition-all">Entrar</button>
                <p id="btn-auth-toggle" class="text-center text-[10px] font-bold text-slate-500 uppercase tracking-widest cursor-pointer hover:text-white transition-colors py-2">N√£o tens conta? Criar Agora</p>
            </div>
        </div>
    </div>

    <div id="modal-post" class="fixed inset-0 z-[100] glass flex items-center justify-center p-4 hidden">
        <div class="bg-[#0f172a] w-full max-w-lg rounded-[2.5rem] border border-white/10 shadow-2xl overflow-hidden flex flex-col max-h-[95vh]">
            <div class="p-6 border-b border-white/5 flex justify-between items-center bg-white/5">
                <h3 class="font-black uppercase tracking-tighter italic text-xl">Novo Mapa</h3>
                <button id="btn-close-post" class="text-slate-400 p-2"><i data-lucide="x"></i></button>
            </div>
            <div class="p-6 space-y-6 overflow-y-auto no-scrollbar">
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 mb-2 block tracking-widest">T√≠tulo do Mapa</label>
                    <input id="post-title" type="text" placeholder="Nome do mapa..." class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 outline-none focus:border-blue-500 transition-all font-bold">
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 mb-2 block tracking-widest">Descri√ß√£o</label>
                    <textarea id="post-desc" placeholder="Detalhes sobre o mapa..." class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 outline-none focus:border-blue-500 transition-all font-medium text-sm h-24 no-scrollbar"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="flex flex-col gap-2">
                        <label class="text-[10px] font-black uppercase text-slate-500 block tracking-widest text-center">Ficheiro (.txt)</label>
                        <input id="post-file" type="file" accept=".txt" class="hidden">
                        <button id="btn-trigger-file" class="w-full bg-white/5 border-2 border-dashed border-white/10 rounded-2xl py-8 flex flex-col items-center gap-2 hover:bg-white/10 transition-all">
                            <i data-lucide="file-text" class="text-blue-500 w-8 h-8"></i>
                            <span id="file-label" class="text-[9px] font-black uppercase text-slate-400">Selecionar</span>
                        </button>
                    </div>
                    <div class="flex flex-col gap-2">
                        <label class="text-[10px] font-black uppercase text-slate-500 block tracking-widest text-center">Capa 16:9</label>
                        <input id="post-image" type="file" accept="image/*" class="hidden">
                        <button id="btn-trigger-image" class="w-full bg-white/5 border-2 border-dashed border-white/10 rounded-2xl py-8 flex flex-col items-center gap-2 hover:bg-white/10 transition-all">
                            <i data-lucide="image" class="text-blue-500 w-8 h-8"></i>
                            <span id="image-label" class="text-[9px] font-black uppercase text-slate-400">Galeria</span>
                        </button>
                    </div>
                </div>
                <div id="crop-area" class="hidden space-y-4">
                    <div id="crop-container"><img id="crop-image-element" src=""></div>
                    <div class="flex items-center justify-between px-3">
                        <span class="text-[10px] font-bold text-slate-500 uppercase italic">Enquadra a Foto</span>
                        <div class="flex gap-3">
                            <button id="btn-crop-zoom-out" class="bg-white/5 p-3 rounded-xl"><i data-lucide="minus" class="w-4 h-4"></i></button>
                            <button id="btn-crop-zoom-in" class="bg-white/10 p-3 rounded-xl"><i data-lucide="plus" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-6 bg-white/5 border-t border-white/10">
                <button id="btn-submit-map" class="w-full bg-blue-600 py-5 rounded-[1.5rem] text-sm font-black uppercase shadow-xl active:scale-95 transition-all">Publicar Agora</button>
            </div>
        </div>
    </div>

    <div id="modal-profile-view" class="fixed inset-0 z-[120] glass flex items-end sm:items-center justify-center hidden">
        <div class="bg-[#020617] w-full max-w-2xl sm:rounded-[2.5rem] rounded-t-[2.5rem] border-t sm:border border-white/10 shadow-2xl overflow-hidden flex flex-col max-h-[95vh]">
            <div class="relative">
                <img id="view-user-banner" src="" class="profile-banner">
                <button onclick="document.getElementById('modal-profile-view').classList.add('hidden')" class="absolute top-4 right-4 bg-black/50 p-2 rounded-full"><i data-lucide="x"></i></button>
                <div class="absolute -bottom-10 left-8">
                    <div class="avatar-frame" id="view-user-avatar-frame">
                        <img id="view-user-avatar" src="" class="w-24 h-24 rounded-full border-4 border-[#020617] object-cover">
                    </div>
                </div>
            </div>
            <div class="pt-14 px-8 pb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <div class="flex items-center gap-2">
                            <h2 id="view-user-name" class="text-2xl font-black uppercase italic tracking-tighter">Nome</h2>
                            <div id="view-user-verified" class="hidden bg-blue-600 p-1 rounded-full"><i data-lucide="check" class="w-3 h-3 text-white"></i></div>
                        </div>
                        <p id="view-user-handle" class="text-blue-500 font-bold text-xs uppercase tracking-widest">@handle</p>
                    </div>
                    <div class="text-right">
                        <span id="view-user-level" class="text-xl font-black italic text-slate-500">LVL 0</span>
                        <p id="view-user-country" class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Pa√≠s</p>
                    </div>
                </div>
                <p id="view-user-bio" class="mt-4 text-slate-400 text-xs italic leading-relaxed max-w-md">Bio do usu√°rio...</p>
                <div class="grid grid-cols-3 gap-4 mt-6 py-4 border-y border-white/5">
                    <div class="text-center">
                        <p id="view-user-maps-count" class="font-black text-lg">0</p>
                        <p class="text-[8px] font-black uppercase text-slate-500 tracking-tighter">Mapas</p>
                    </div>
                    <div class="text-center border-x border-white/5">
                        <p id="view-user-likes-count" class="font-black text-lg text-emerald-500">0</p>
                        <p class="text-[8px] font-black uppercase text-slate-500 tracking-tighter">Likes</p>
                    </div>
                    <div class="text-center">
                        <p id="view-user-date" class="font-black text-sm pt-1">---</p>
                        <p class="text-[8px] font-black uppercase text-slate-500 tracking-tighter">Membro</p>
                    </div>
                </div>
                <div class="mt-6">
                    <p class="text-[9px] font-black uppercase text-slate-500 tracking-widest mb-4">Obras de Arte</p>
                    <div id="view-user-grid" class="grid grid-cols-2 gap-3 overflow-y-auto no-scrollbar max-h-[30vh]"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-settings" class="fixed inset-0 z-[120] glass flex items-center justify-center p-4 hidden">
        <div class="bg-[#0f172a] w-full max-w-md rounded-[2.5rem] border border-white/10 shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="p-6 border-b border-white/5 flex justify-between items-center bg-white/5">
                <h3 class="font-black uppercase tracking-tighter italic text-xl">Editar Perfil</h3>
                <button onclick="document.getElementById('modal-settings').classList.add('hidden')" class="text-slate-400 p-2"><i data-lucide="x"></i></button>
            </div>
            <div class="p-8 space-y-5 overflow-y-auto no-scrollbar">
                <div class="flex gap-4">
                    <div class="flex-1">
                        <label class="text-[9px] font-black uppercase text-slate-500 mb-2 block">Capa (16:9)</label>
                        <input id="edit-banner-input" type="file" accept="image/*" class="hidden">
                        <div onclick="document.getElementById('edit-banner-input').click()" class="h-20 bg-slate-800 rounded-xl border-2 border-dashed border-white/10 flex items-center justify-center overflow-hidden cursor-pointer">
                            <img id="edit-banner-preview" class="w-full h-full object-cover hidden">
                            <i data-lucide="image" class="text-slate-600"></i>
                        </div>
                    </div>
                    <div class="w-20">
                        <label class="text-[9px] font-black uppercase text-slate-500 mb-2 block text-center">Avatar</label>
                        <input id="edit-avatar-input" type="file" accept="image/*" class="hidden">
                        <div onclick="document.getElementById('edit-avatar-input').click()" class="w-20 h-20 bg-slate-800 rounded-full border-2 border-dashed border-white/10 flex items-center justify-center overflow-hidden cursor-pointer">
                            <img id="edit-avatar-preview" class="w-full h-full object-cover">
                            <i data-lucide="camera" class="text-slate-600 absolute"></i>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 mb-2 block">Nome de Exibi√ß√£o</label>
                    <input id="edit-name" type="text" class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 outline-none focus:border-blue-500 font-bold">
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 mb-2 block">Identificador (@)</label>
                    <input id="edit-handle" type="text" class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 outline-none focus:border-blue-500 font-bold lowercase">
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 mb-2 block">Seu Pa√≠s</label>
                    <select id="edit-country-select" class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 outline-none focus:border-blue-500 font-bold uppercase text-slate-300">
                        </select>
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 mb-2 block">Bio (M√°x 150)</label>
                    <textarea id="edit-bio" maxlength="150" class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 outline-none focus:border-blue-500 font-medium text-xs h-20 no-scrollbar"></textarea>
                </div>
                <button id="btn-save-settings" class="w-full bg-blue-600 py-5 rounded-[1.5rem] text-sm font-black uppercase shadow-xl">Salvar Mudan√ßas</button>
            </div>
        </div>
    </div>

    <footer class="mt-auto py-12 border-t border-white/5 bg-slate-950/50 text-center">
        <div class="text-[11px] font-black uppercase tracking-[0.5em] mb-4 text-slate-400 italic">LacMapper‚Ñ¢ 2025</div>
        <div class="flex justify-center gap-6 text-[9px] font-black uppercase tracking-widest text-slate-600">
            <span>Sobre</span>
            <span>Regras</span>
            <span>Discord</span>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, push, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCKhcg84B_EqFKJ6Xe_EZnW1KRq-T_gcwU",
            authDomain: "jogo2donline.firebaseapp.com",
            databaseURL: "https://jogo2donline-default-rtdb.firebaseio.com",
            projectId: "jogo2donline",
            storageBucket: "jogo2donline.firebasestorage.app",
            messagingSenderId: "782226902162",
            appId: "1:782226902162:web:d316d0b3a62acac6afaa4b",
            measurementId: "G-XDW14K64TV"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let userSession = JSON.parse(localStorage.getItem('lac_user')) || null;
        let dataMaps = [];
        let dataUsers = {};
        let tabMode = 'recentes';
        let authIsRegister = false;
        let cropInfo = { x: 0, y: 0, scale: 1, dragging: false, startX: 0, startY: 0 };
        let tempAvatar = "";
        let tempBanner = "";
        let tempFile = { content: "", size: 0 };
        let rankingMode = 'global';

        // LISTA DE PA√çSES (REQUISITO 1)
        const countryList = [
            { name: "Brasil", flag: "üáßüá∑" },
            { name: "Portugal", flag: "üáµüáπ" },
            { name: "Angola", flag: "üá¶üá¥" },
            { name: "Mo√ßambique", flag: "üá≤üáø" },
            { name: "Estados Unidos", flag: "üá∫üá∏" },
            { name: "Cabo Verde", flag: "üá®üáª" },
            { name: "Guin√©-Bissau", flag: "üá¨üáº" },
            { name: "Timor-Leste", flag: "üáπüá±" },
            { name: "Argentina", flag: "üá¶üá∑" },
            { name: "Espanha", flag: "üá™üá∏" },
            { name: "Fran√ßa", flag: "üá´üá∑" },
            { name: "Reino Unido", flag: "üá¨üáß" },
            { name: "It√°lia", flag: "üáÆüáπ" },
            { name: "Alemanha", flag: "üá©üá™" },
            { name: "Jap√£o", flag: "üáØüáµ" },
            { name: "M√©xico", flag: "üá≤üáΩ" },
            { name: "Outro", flag: "üåç" }
        ];

        const populateCountries = () => {
            const select = document.getElementById('edit-country-select');
            select.innerHTML = '<option value="">Selecionar Pa√≠s</option>';
            countryList.forEach(c => {
                const opt = document.createElement('option');
                opt.value = `${c.flag} ${c.name}`;
                opt.innerText = `${c.flag} ${c.name}`;
                select.appendChild(opt);
            });
        };
        populateCountries();

        const startSync = () => {
            onValue(ref(db, 'lacmapper/users'), (snap) => { 
                dataUsers = snap.val() || {}; 
                if(userSession && dataUsers[userSession.handle]) {
                    userSession = dataUsers[userSession.handle];
                    localStorage.setItem('lac_user', JSON.stringify(userSession));
                }
                refreshAuthUI();
                renderMaps();
            });
            onValue(ref(db, 'lacmapper/maps'), (snap) => {
                const raw = snap.val();
                dataMaps = [];
                if (raw) for (let key in raw) dataMaps.push({ ...raw[key], id: key });
                const loadingEl = document.getElementById('loading');
                if(loadingEl) loadingEl.classList.add('hidden');
                renderMaps();
            });
        };
        startSync();

        const calculateLevel = (xp) => Math.floor(Math.sqrt(xp / 100)) + 1;

        const isVerified = (handle) => {
            const user = dataUsers[handle];
            if(!user) return false;
            const mapsCount = dataMaps.filter(m => m.handle === handle).length;
            const likesCount = dataMaps.filter(m => m.handle === handle).reduce((acc, m) => acc + (m.likes || 0), 0);
            const level = calculateLevel(user.xp || 0);
            return level >= 30 && mapsCount >= 30 && likesCount >= 200;
        };

        const refreshAuthUI = () => {
            const navUnlogged = document.getElementById('nav-unlogged');
            const navLogged = document.getElementById('nav-logged');
            if (userSession) {
                navUnlogged.classList.add('hidden');
                navLogged.classList.remove('hidden');
                document.getElementById('nav-avatar').src = userSession.avatar;
                
                const navFrame = document.getElementById('nav-avatar-frame');
                if(isVerified(userSession.handle)) navFrame.classList.add('verified');
                else navFrame.classList.remove('verified');
            } else {
                navUnlogged.classList.remove('hidden');
                navLogged.classList.add('hidden');
            }
        };

        // RANKING LOGIC (REQUISITO 2)
        const renderRanking = () => {
            const listContainer = document.getElementById('ranking-list');
            listContainer.innerHTML = '';
            
            // Criar array de stats por usu√°rio
            let usersStats = Object.keys(dataUsers).map(handle => {
                const user = dataUsers[handle];
                const maps = dataMaps.filter(m => m.handle === handle);
                const totalDownloads = maps.reduce((acc, m) => acc + (m.downloads || 0), 0);
                const totalLikes = maps.reduce((acc, m) => acc + (m.likes || 0), 0);
                return { ...user, totalDownloads, totalLikes };
            });

            // Filtrar por pa√≠s se necess√°rio
            if(rankingMode === 'country') {
                if(!userSession || !userSession.country) {
                    listContainer.innerHTML = `<div class='text-center py-10 opacity-50 text-[10px] font-black uppercase'>Define o teu pa√≠s no perfil para ver este ranking!</div>`;
                    return;
                }
                usersStats = usersStats.filter(u => u.country === userSession.country);
            }

            // Sort: Prioridade Downloads, depois Likes
            usersStats.sort((a,b) => {
                if(b.totalDownloads !== a.totalDownloads) return b.totalDownloads - a.totalDownloads;
                return b.totalLikes - a.totalLikes;
            });

            // Pegar Top 50
            const top50 = usersStats.slice(0, 50);

            top50.forEach((user, index) => {
                const rank = index + 1;
                const verified = isVerified(user.handle);
                const item = document.createElement('div');
                item.className = `flex items-center gap-4 p-4 rounded-2xl transition-all rank-card ${rank <= 3 ? 'rank-'+rank : ''}`;
                item.innerHTML = `
                    <div class="w-8 text-center font-black italic text-xl ${rank === 1 ? 'text-yellow-500' : 'text-slate-500'}">#${rank}</div>
                    <div class="avatar-frame ${verified ? 'verified' : ''}">
                        <img src="${user.avatar}" class="w-10 h-10 rounded-full object-cover">
                    </div>
                    <div class="flex-grow">
                        <div class="flex items-center gap-1">
                            <h4 class="text-[10px] font-black uppercase italic">${user.name}</h4>
                            ${user.country ? `<span class="text-[10px]">${user.country.split(' ')[0]}</span>` : ''}
                        </div>
                        <p class="text-[9px] font-bold text-blue-500 uppercase tracking-widest">@${user.handle}</p>
                    </div>
                    <div class="text-right">
                        <div class="flex items-center gap-1 justify-end text-white font-black text-xs italic">
                            <i data-lucide="download" class="w-3 h-3 text-blue-500"></i> ${user.totalDownloads}
                        </div>
                        <div class="text-[8px] font-black uppercase text-slate-500">Downloads</div>
                    </div>
                `;
                item.onclick = () => {
                    document.getElementById('modal-ranking').classList.add('hidden');
                    openUserProfile(user.handle);
                };
                listContainer.appendChild(item);
            });
            if(window.lucide) lucide.createIcons();
        };

        document.getElementById('btn-trigger-ranking').onclick = () => {
            rankingMode = 'global';
            document.getElementById('rank-tab-global').classList.add('active-tab');
            document.getElementById('rank-tab-country').classList.remove('active-tab');
            renderRanking();
            document.getElementById('modal-ranking').classList.remove('hidden');
        };

        document.getElementById('rank-tab-global').onclick = () => {
            rankingMode = 'global';
            document.getElementById('rank-tab-global').classList.add('active-tab');
            document.getElementById('rank-tab-global').classList.remove('text-slate-500');
            document.getElementById('rank-tab-country').classList.remove('active-tab');
            document.getElementById('rank-tab-country').classList.add('text-slate-500');
            renderRanking();
        };

        document.getElementById('rank-tab-country').onclick = () => {
            rankingMode = 'country';
            document.getElementById('rank-tab-country').classList.add('active-tab');
            document.getElementById('rank-tab-country').classList.remove('text-slate-500');
            document.getElementById('rank-tab-global').classList.remove('active-tab');
            document.getElementById('rank-tab-global').classList.add('text-slate-500');
            renderRanking();
        };

        // EVENTOS DE NAVEGA√á√ÉO / AUTH
        document.getElementById('btn-trigger-login').addEventListener('click', () => {
            authIsRegister = false;
            updateAuthModalView();
            document.getElementById('modal-auth').classList.remove('hidden');
        });

        document.getElementById('nav-avatar').addEventListener('click', () => {
            openSettings();
        });

        document.getElementById('btn-auth-toggle').addEventListener('click', () => {
            authIsRegister = !authIsRegister;
            updateAuthModalView();
        });

        const updateAuthModalView = () => {
            document.getElementById('auth-header-title').innerText = authIsRegister ? "Criar Conta" : "Fazer Login";
            document.getElementById('btn-auth-confirm').innerText = authIsRegister ? "Cadastrar" : "Entrar";
            document.getElementById('btn-auth-toggle').innerText = authIsRegister ? "J√° tens conta? Entrar" : "N√£o tens conta? Criar Agora";
            document.getElementById('auth-register-only').classList.toggle('hidden', !authIsRegister);
            document.getElementById('auth-register-pass-confirm').classList.toggle('hidden', !authIsRegister);
            document.getElementById('auth-error-msg').classList.add('hidden');
        };

        document.getElementById('auth-avatar-input').addEventListener('change', (e) => {
            const f = e.target.files[0];
            if (!f) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                tempAvatar = ev.target.result;
                document.getElementById('auth-avatar-preview').src = tempAvatar;
                document.getElementById('auth-avatar-preview').classList.remove('hidden');
                document.getElementById('auth-avatar-icon').classList.add('hidden');
            };
            reader.readAsDataURL(f);
        });

        document.getElementById('btn-auth-confirm').addEventListener('click', async () => {
            const handle = document.getElementById('auth-handle').value.toLowerCase().replace(/[^a-z_0-9]/g, '');
            const pass = document.getElementById('auth-pass').value;
            const err = document.getElementById('auth-error-msg');
            err.classList.add('hidden');

            if (authIsRegister) {
                const name = document.getElementById('auth-name').value;
                const passConfirm = document.getElementById('auth-pass-confirm').value;
                if (name.length < 4 || handle.length < 3 || pass.length < 8 || !tempAvatar) {
                    err.innerText = "Dados Inv√°lidos ou Curtos!";
                    return err.classList.remove('hidden');
                }
                if (pass !== passConfirm) {
                    err.innerText = "As senhas n√£o coincidem!";
                    return err.classList.remove('hidden');
                }
                if (dataUsers[handle]) {
                    err.innerText = "Este @identificador j√° existe!";
                    return err.classList.remove('hidden');
                }
                
                const userData = { 
                    name, handle, avatar: tempAvatar, pass, 
                    xp: 0, banner: "", bio: "", country: "", date: Date.now() 
                };
                
                set(ref(db, 'lacmapper/users/' + handle), userData).then(() => {
                    userSession = userData;
                    localStorage.setItem('lac_user', JSON.stringify(userData));
                    document.getElementById('modal-auth').classList.add('hidden');
                    refreshAuthUI();
                    showToast("Bem-vindo ao LacMapper!");
                });
            } else {
                const u = dataUsers[handle];
                if (u && u.pass === pass) {
                    userSession = u;
                    localStorage.setItem('lac_user', JSON.stringify(u));
                    document.getElementById('modal-auth').classList.add('hidden');
                    refreshAuthUI();
                    showToast("Login realizado!");
                    renderMaps();
                } else {
                    err.innerText = "Informa√ß√µes Inv√°lidas";
                    err.classList.remove('hidden');
                }
            }
        });

        document.getElementById('btn-trigger-logout').addEventListener('click', () => {
            localStorage.removeItem('lac_user');
            userSession = null;
            refreshAuthUI();
            renderMaps();
        });

        const openSettings = () => {
            document.getElementById('edit-name').value = userSession.name;
            document.getElementById('edit-handle').value = userSession.handle;
            document.getElementById('edit-bio').value = userSession.bio || "";
            document.getElementById('edit-country-select').value = userSession.country || "";
            document.getElementById('edit-avatar-preview').src = userSession.avatar;
            if(userSession.banner) {
                document.getElementById('edit-banner-preview').src = userSession.banner;
                document.getElementById('edit-banner-preview').classList.remove('hidden');
            }
            tempAvatar = userSession.avatar;
            tempBanner = userSession.banner || "";
            document.getElementById('modal-settings').classList.remove('hidden');
        };

        document.getElementById('edit-avatar-input').onchange = (e) => {
            const reader = new FileReader();
            reader.onload = (ev) => { tempAvatar = ev.target.result; document.getElementById('edit-avatar-preview').src = tempAvatar; };
            reader.readAsDataURL(e.target.files[0]);
        };

        document.getElementById('edit-banner-input').onchange = (e) => {
            const reader = new FileReader();
            reader.onload = (ev) => { 
                tempBanner = ev.target.result; 
                document.getElementById('edit-banner-preview').src = tempBanner; 
                document.getElementById('edit-banner-preview').classList.remove('hidden');
            };
            reader.readAsDataURL(e.target.files[0]);
        };

        document.getElementById('btn-save-settings').onclick = async () => {
            const newName = document.getElementById('edit-name').value;
            const newHandle = document.getElementById('edit-handle').value.toLowerCase().replace(/[^a-z_0-9]/g, '');
            const newBio = document.getElementById('edit-bio').value;
            const newCountry = document.getElementById('edit-country-select').value;

            if(newName.length < 4 || newHandle.length < 3) return showToast("Dados curtos!");

            const updates = {
                name: newName,
                handle: newHandle,
                bio: newBio,
                country: newCountry,
                avatar: tempAvatar,
                banner: tempBanner
            };

            if(newHandle !== userSession.handle) {
                if(dataUsers[newHandle]) return showToast("Handle ocupado!");
                await set(ref(db, 'lacmapper/users/' + newHandle), { ...userSession, ...updates });
                await remove(ref(db, 'lacmapper/users/' + userSession.handle));
                
                dataMaps.forEach(m => {
                    if(m.handle === userSession.handle) {
                        update(ref(db, 'lacmapper/maps/' + m.id), { handle: newHandle, author: newName, avatar: tempAvatar });
                    }
                });
            } else {
                await update(ref(db, 'lacmapper/users/' + userSession.handle), updates);
            }

            showToast("Perfil atualizado!");
            document.getElementById('modal-settings').classList.add('hidden');
        };

        const openUserProfile = (handle) => {
            const user = dataUsers[handle];
            if(!user) return;

            const maps = dataMaps.filter(m => m.handle === handle);
            const likes = maps.reduce((acc, m) => acc + (m.likes || 0), 0);
            const verified = isVerified(handle);

            document.getElementById('view-user-name').innerText = user.name;
            document.getElementById('view-user-handle').innerText = '@' + user.handle;
            document.getElementById('view-user-avatar').src = user.avatar;
            document.getElementById('view-user-banner').src = user.banner || 'https://images.unsplash.com/photo-1614850523296-d8c1af93d400?w=800';
            document.getElementById('view-user-bio').innerText = user.bio || "Este criador prefere o mist√©rio.";
            document.getElementById('view-user-country').innerText = user.country || "Planeta Terra";
            document.getElementById('view-user-level').innerText = 'LVL ' + calculateLevel(user.xp || 0);
            document.getElementById('view-user-maps-count').innerText = maps.length;
            document.getElementById('view-user-likes-count').innerText = likes;
            document.getElementById('view-user-date').innerText = new Date(user.date || Date.now()).getFullYear();

            const vBadge = document.getElementById('view-user-verified');
            const vFrame = document.getElementById('view-user-avatar-frame');
            if(verified) { vBadge.classList.remove('hidden'); vFrame.classList.add('verified'); }
            else { vBadge.classList.add('hidden'); vFrame.classList.remove('verified'); }

            const grid = document.getElementById('view-user-grid');
            grid.innerHTML = '';
            maps.forEach(m => {
                grid.innerHTML += `<img src="${m.image}" class="aspect-video object-cover rounded-xl border border-white/10">`;
            });

            document.getElementById('modal-profile-view').classList.remove('hidden');
            if(window.lucide) lucide.createIcons();
        };

        const cropImg = document.getElementById('crop-image-element');
        document.getElementById('post-image').addEventListener('change', (e) => {
            const f = e.target.files[0];
            if (!f) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                cropImg.src = ev.target.result;
                document.getElementById('crop-area').classList.remove('hidden');
                cropInfo = { x: 0, y: 0, scale: 1, dragging: false };
                updateCropStyle();
                document.getElementById('image-label').innerText = "‚úì FOTO";
            };
            reader.readAsDataURL(f);
        });

        const updateCropStyle = () => {
            cropImg.style.transform = `translate(${cropInfo.x}px, ${cropInfo.y}px) scale(${cropInfo.scale})`;
        };

        const cropBox = document.getElementById('crop-container');
        const onStart = (e) => {
            cropInfo.dragging = true;
            const cx = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            const cy = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            cropInfo.startX = cx - cropInfo.x;
            cropInfo.startY = cy - cropInfo.y;
        };
        const onMove = (e) => {
            if (!cropInfo.dragging) return;
            const cx = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            const cy = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            cropInfo.x = cx - cropInfo.startX;
            cropInfo.y = cy - cropInfo.startY;
            updateCropStyle();
        };
        cropBox.addEventListener('mousedown', onStart);
        cropBox.addEventListener('touchstart', onStart, {passive: true});
        window.addEventListener('mousemove', onMove);
        window.addEventListener('touchmove', onMove, {passive: true});
        window.addEventListener('mouseup', () => cropInfo.dragging = false);
        window.addEventListener('touchend', () => cropInfo.dragging = false);

        document.getElementById('btn-crop-zoom-in').addEventListener('click', () => { cropInfo.scale += 0.2; updateCropStyle(); });
        document.getElementById('btn-crop-zoom-out').addEventListener('click', () => { cropInfo.scale = Math.max(0.1, cropInfo.scale - 0.2); updateCropStyle(); });

        document.getElementById('post-file').addEventListener('change', (e) => {
            const f = e.target.files[0];
            if (!f) return;
            tempFile.size = f.size;
            const reader = new FileReader();
            reader.onload = (ev) => {
                tempFile.content = ev.target.result;
                document.getElementById('file-label').innerText = "‚úì TXT";
            };
            reader.readAsText(f);
        });

        const showAdPage = () => {
            const modal = document.getElementById('ad-interstitial');
            const timerEl = document.getElementById('close-ad-timer');
            let timeLeft = 5;
            modal.style.display = 'flex';
            
            const interval = setInterval(() => {
                timeLeft--;
                timerEl.innerText = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(interval);
                    timerEl.innerHTML = '<i data-lucide="x"></i>';
                    lucide.createIcons();
                    timerEl.classList.add('ready');
                    timerEl.onclick = () => {
                        modal.style.display = 'none';
                        document.getElementById('modal-post').classList.add('hidden');
                        showToast("Mapa publicado!");
                    };
                }
            }, 1000);
        };

        document.getElementById('btn-submit-map').addEventListener('click', async () => {
            const title = document.getElementById('post-title').value;
            const desc = document.getElementById('post-desc').value;
            if (!title || !tempFile.content || !cropImg.src) return showToast("Faltam informa√ß√µes!");

            const btn = document.getElementById('btn-submit-map');
            btn.disabled = true; btn.innerText = "A Enviar...";

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 1280; canvas.height = 720;
            const img = new Image();
            img.src = cropImg.src;
            img.onload = () => {
                ctx.fillStyle = "#000"; ctx.fillRect(0,0,1280,720);
                const r = 1280 / cropBox.offsetWidth;
                ctx.save();
                ctx.translate(640 + cropInfo.x * r, 360 + cropInfo.y * r);
                ctx.scale(cropInfo.scale * (1280 / cropImg.offsetWidth), cropInfo.scale * (1280 / cropImg.offsetWidth));
                ctx.drawImage(img, -img.width/2, -img.height/2);
                ctx.restore();

                const refNew = push(ref(db, 'lacmapper/maps'));
                set(refNew, {
                    title, desc: desc || "Sem descri√ß√£o.",
                    author: userSession.name, handle: userSession.handle, avatar: userSession.avatar,
                    image: canvas.toDataURL('image/jpeg', 0.8),
                    file: tempFile.content, size: tempFile.size,
                    downloads: 0, likes: 0, dislikes: 0, time: Date.now()
                }).then(() => {
                    update(ref(db, 'lacmapper/users/' + userSession.handle), { xp: (userSession.xp || 0) + 100 });
                    btn.disabled = false; 
                    btn.innerText = "Publicar Agora";
                    resetPostModal();
                    showAdPage();
                });
            };
        });

        const resetPostModal = () => {
            document.getElementById('post-title').value = "";
            document.getElementById('post-desc').value = "";
            document.getElementById('crop-area').classList.add('hidden');
            document.getElementById('file-label').innerText = "Selecionar";
            document.getElementById('image-label').innerText = "Galeria";
            tempFile = { content: "", size: 0 };
        };

        const getWeight = (b) => b < 1048576 ? (b/1024).toFixed(0) + ' KB' : (b/1048576).toFixed(1) + ' MB';

        function renderMaps() {
            const grid = document.getElementById('map-grid');
            if(!grid) return;
            grid.innerHTML = '';
            
            let list = [...dataMaps];
            if (tabMode === 'populares') {
                list.sort((a,b) => {
                    const aV = isVerified(a.handle) ? 1 : 0;
                    const bV = isVerified(b.handle) ? 1 : 0;
                    if(aV !== bV) return bV - aV;
                    return (b.likes - b.dislikes) - (a.likes - a.dislikes);
                });
            } else {
                list.sort((a,b) => b.time - a.time);
            }

            const q = document.getElementById('input-search').value.toLowerCase();
            const filtered = list.filter(m => m.title.toLowerCase().includes(q) || m.handle.toLowerCase().includes(q));

            filtered.forEach(map => {
                const date = new Intl.DateTimeFormat('pt-BR', { day: 'numeric', month: 'short' }).format(map.time);
                const verified = isVerified(map.handle);
                const card = document.createElement('div');
                card.className = `glass rounded-[2.5rem] overflow-hidden flex flex-col card-anim ${verified ? 'verified-border' : ''}`;
                card.innerHTML = `
                    <div class="aspect-[16/9] overflow-hidden bg-slate-900 relative">
                        <img src="${map.image}" class="w-full h-full object-cover">
                        <div class="absolute bottom-3 left-3 flex gap-1">
                             <span class="text-[7px] font-black uppercase tracking-widest px-2.5 py-1 bg-black/60 backdrop-blur rounded-full text-white">${date}</span>
                             <span class="text-[7px] font-black uppercase tracking-widest px-2.5 py-1 bg-black/60 backdrop-blur rounded-full text-blue-400 font-bold">${getWeight(map.size)}</span>
                        </div>
                    </div>
                    <div class="p-6 flex flex-col flex-grow">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-base font-black uppercase italic tracking-tighter truncate leading-none">${map.title}</h3>
                            <div class="flex items-center gap-1 text-slate-500">
                                <i data-lucide="download" class="w-3 h-3"></i>
                                <span class="text-[9px] font-black">${map.downloads}</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 mb-3 cursor-pointer user-trigger" data-handle="${map.handle}">
                            <div class="avatar-frame ${verified ? 'verified' : ''}">
                                <img src="${map.avatar}" class="w-5 h-5 rounded-full border border-white/10 object-cover">
                            </div>
                            <p class="text-[8px] font-bold text-blue-500 uppercase tracking-widest">@${map.handle}</p>
                            ${verified ? '<div class="bg-blue-600 p-0.5 rounded-full"><i data-lucide="check" class="w-2 h-2 text-white"></i></div>' : ''}
                        </div>
                        <p class="text-[9px] text-slate-400 font-medium mb-5 line-clamp-2 h-7 italic opacity-70">${map.desc}</p>
                        <div class="mt-auto flex items-center justify-between border-t border-white/5 pt-4">
                            <div class="flex items-center gap-3">
                                <button class="btn-up flex items-center gap-1.5 text-emerald-500 active:scale-90" data-id="${map.id}" data-handle="${map.handle}">
                                    <i data-lucide="thumbs-up" class="w-4 h-4"></i>
                                    <span class="text-[10px] font-black">${map.likes}</span>
                                </button>
                                <button class="btn-down flex items-center gap-1.5 text-rose-500 active:scale-90" data-id="${map.id}">
                                    <i data-lucide="thumbs-down" class="w-4 h-4"></i>
                                    <span class="text-[10px] font-black">${map.dislikes}</span>
                                </button>
                            </div>
                            <button class="btn-dl bg-white text-black px-5 py-2.5 rounded-xl text-[9px] font-black uppercase active:scale-90 shadow-lg" data-id="${map.id}" data-handle="${map.handle}">Baixar</button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });

            document.querySelectorAll('.user-trigger').forEach(b => b.onclick = () => openUserProfile(b.dataset.handle));
            document.querySelectorAll('.btn-up').forEach(b => b.addEventListener('click', () => voteMap(b.dataset.id, 'likes', b.dataset.handle)));
            document.querySelectorAll('.btn-down').forEach(b => b.addEventListener('click', () => voteMap(b.dataset.id, 'dislikes', null)));
            document.querySelectorAll('.btn-dl').forEach(b => b.addEventListener('click', () => downloadMap(b.dataset.id, b.dataset.handle)));
            if(window.lucide) lucide.createIcons();
        }

        const voteMap = (id, field, authorHandle) => {
            if (!userSession) return showToast("Logue primeiro!");
            if (localStorage.getItem('voted_' + id)) return showToast("J√° votou!");
            const target = dataMaps.find(m => m.id === id);
            if(!target) return;
            update(ref(db, 'lacmapper/maps/' + id), { [field]: (target[field] || 0) + 1 });
            localStorage.setItem('voted_' + id, '1');
            
            if(field === 'likes' && authorHandle && dataUsers[authorHandle]) {
                update(ref(db, 'lacmapper/users/' + authorHandle), { xp: (dataUsers[authorHandle].xp || 0) + 20 });
            }
        };

        const downloadMap = (id, authorHandle) => {
            const m = dataMaps.find(m => m.id === id);
            if(!m) return;
            const fileName = m.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s+/g, '_') + '.txt';
            const b = new Blob([m.file], { type: 'text/plain' });
            const u = URL.createObjectURL(b);
            const a = document.createElement('a');
            a.href = u; a.download = fileName;
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
            update(ref(db, 'lacmapper/maps/' + id), { downloads: (m.downloads || 0) + 1 });
            
            if(authorHandle && dataUsers[authorHandle]) {
                update(ref(db, 'lacmapper/users/' + authorHandle), { xp: (dataUsers[authorHandle].xp || 0) + 5 });
            }
            showToast("Baixando...");
        };

        // UI ACTIONS
        document.getElementById('btn-close-auth').onclick = () => document.getElementById('modal-auth').classList.add('hidden');
        document.getElementById('btn-close-post').onclick = () => document.getElementById('modal-post').classList.add('hidden');
        document.getElementById('btn-trigger-post').onclick = () => {
            if(!userSession) return showToast("Logue primeiro!");
            document.getElementById('modal-post').classList.remove('hidden');
        };
        document.getElementById('tab-recent').onclick = () => { tabMode = 'recentes'; updateTabUI(); renderMaps(); };
        document.getElementById('tab-popular').onclick = () => { tabMode = 'populares'; updateTabUI(); renderMaps(); };
        const updateTabUI = () => {
            document.getElementById('tab-recent').classList.toggle('active-tab', tabMode === 'recentes');
            document.getElementById('tab-popular').classList.toggle('active-tab', tabMode === 'populares');
        };
        document.getElementById('input-search').addEventListener('input', renderMaps);
        document.getElementById('btn-trigger-file').onclick = () => document.getElementById('post-file').click();
        document.getElementById('btn-trigger-image').onclick = () => document.getElementById('post-image').click();

        function showToast(txt) {
            const t = document.getElementById('toast');
            const tt = document.getElementById('toast-text');
            if(!t || !tt) return;
            tt.innerText = txt;
            t.classList.remove('hidden');
            setTimeout(() => t.classList.add('hidden'), 3000);
        }

        const adjustAdScale = () => {
            const slots = document.querySelectorAll('.ad-slot-main');
            slots.forEach(slot => {
                const scaler = slot.querySelector('.ad-scaler-el');
                if (!slot || !scaler) return;
                const availableWidth = slot.offsetWidth;
                const adWidth = 728; 
                if (availableWidth < adWidth) {
                    const scale = (availableWidth / adWidth) * 0.95;
                    scaler.style.transform = `scale(${scale})`;
                    slot.style.height = (90 * scale) + 'px';
                } else {
                    scaler.style.transform = 'scale(1)';
                    slot.style.height = '90px';
                }
            });
        };

        window.addEventListener('resize', adjustAdScale);
        [500, 1000, 2000, 5000].forEach(ms => setTimeout(adjustAdScale, ms));
        window.onload = () => { if(window.lucide) lucide.createIcons(); };
    </script>
    </script>

<!-- SCRIPT DE AN√öNCIOS -->
<script>
(function () {
  function load(src, attrs = {}) {
    try {
      const s = document.createElement('script');
      s.src = src;
      s.async = true;
      Object.entries(attrs).forEach(([k, v]) => s.setAttribute(k, v));
      document.body.appendChild(s);
    } catch (e) {
      console.log('An√∫ncio bloqueado:', src);
    }
  }

  function carregarAnuncios() {
    load('https://pl28308314.effectivegatecpm.com/c0/32/00/c032003c376ec812a388135541d20cf3.js');

    load(
      'https://pl28308463.effectivegatecpm.com/1f32791f740b14e44a8b9a32b19185f7/invoke.js',
      { 'data-cfasync': 'false' }
    );

    window.atOptions = {
      key: 'f2fc11825c77506816279c5b1393084e',
      format: 'iframe',
      height: 90,
      width: 728,
      params: {}
    };
    load('https://www.highperformanceformat.com/f2fc11825c77506816279c5b1393084e/invoke.js');

    window.atOptions = {
      key: '745cf56074e768501f24905439e2eb11',
      format: 'iframe',
      height: 250,
      width: 300,
      params: {}
    };
    load('https://www.highperformanceformat.com/745cf56074e768501f24905439e2eb11/invoke.js');
  }

  window.addEventListener('load', () => {
    setTimeout(carregarAnuncios, 1200);
  });
})();
</script>
</body>
</html>
